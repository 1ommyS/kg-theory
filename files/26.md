
## 26. В-сплайны. Их свойства.

### 26.1. Определение

**В-сплайны** (B-splines) — это класс сплайнов, характеризующихся их гибкостью и возможностью управления формой кривой через набор контрольных точек и весов. Они являются обобщением кубических сплайнов и обеспечивают более высокую степень контроля над формой кривой.

### 26.2. Свойства В-сплайнов

1. **Базисные функции**:
    - Используют базисные функции Б-сплайнов для определения влияния контрольных точек на форму кривой.

2. **Локальное управление**:
    - Изменение одной контрольной точки влияет только на часть кривой, что упрощает редактирование.

3. **Непрерывность**:
    - Обеспечивают высокую степень гладкости (непрерывность первых и вторых производных) по всей длине кривой.

4. **Универсальность**:
    - Поддерживают как интерполяцию (кривая проходит через все контрольные точки), так и аппроксимацию (кривая приближается к контрольным точкам).

5. **Кусочная природа**:
    - Кривая разбивается на отдельные сегменты, каждый из которых определяется небольшим набором контрольных точек.

6. **Параметризация**:
    - Позволяют использовать неравномерные узлы, обеспечивая большую гибкость в моделировании форм.

### 26.3. Формула В-сплайна

В-сплайн кривой степени \( k \) определяется следующим образом:

\[
C(u) = \sum_{i=0}^{n} N_{i,k}(u) \cdot P_i
\]

- \( u \) — параметр, изменяющийся от 0 до 1.
- \( N_{i,k}(u) \) — базисные функции Б-сплайнов степени \( k \).
- \( P_i \) — контрольные точки.

### 26.4. Преимущества В-сплайнов

1. **Гибкость и контроль**:
    - Позволяют точно контролировать форму кривой через настройку контрольных точек и узлов.

2. **Локальное управление**:
    - Изменение одной контрольной точки влияет только на локальную часть кривой.

3. **Высокая гладкость**:
    - Обеспечивают плавные и непрерывные формы без резких изменений направления.

4. **Универсальность**:
    - Подходят для широкого спектра приложений, от 3D-моделирования до компьютерной анимации.

### 26.5. Недостатки В-сплайнов

1. **Сложность вычислений**:
    - Требуют более сложных алгоритмов для вычисления базисных функций и построения кривых.

2. **Высокие требования к памяти**:
    - Могут требовать значительного объёма памяти для хранения контрольных точек и узлов.

3. **Пониженная интуитивность**:
    - Требуют более глубокого понимания математических основ для эффективного использования.

### 26.6. Применение В-сплайнов

- **3D-моделирование и анимация**: Для создания гладких и реалистичных форм объектов и анимаций.
- **Графический дизайн**: Для рисования плавных и сложных линий и контуров.
- **CAD-системы**: Для точного проектирования технических деталей и конструкций.
- **Веб-графика**: Использование в векторных форматах, таких как SVG, для создания масштабируемых графических элементов.

### 26.7. Пример реализации В-сплайна

```cpp
#include <vector>
#include <QVector3D>

// Функция для вычисления базисной функции Б-сплайна
float BSplineBasis(int i, int k, float u, const std::vector<float> &knots) {
    if (k == 1) {
        if (knots[i] <= u && u < knots[i+1]) {
            return 1.0f;
        } else {
            return 0.0f;
        }
    } else {
        float denom1 = knots[i+k-1] - knots[i];
        float term1 = (denom1 == 0) ? 0 : ((u - knots[i]) / denom1) * BSplineBasis(i, k-1, u, knots);
        
        float denom2 = knots[i+k] - knots[i+1];
        float term2 = (denom2 == 0) ? 0 : ((knots[i+k] - u) / denom2) * BSplineBasis(i+1, k-1, u, knots);
        
        return term1 + term2;
    }
}

// Функция для построения В-сплайна
QVector3D BSplineCurve(float u, const std::vector<QVector3D> &controlPoints, const std::vector<float> &knots, int degree) {
    int n = controlPoints.size();
    int k = degree + 1; // Порядок сплайна
    QVector3D C(0, 0, 0);

    for (int i = 0; i < n; ++i) {
        C += BSplineBasis(i, k, u, knots) * controlPoints[i];
    }

    return C;
}

int main() {
    std::vector<QVector3D> controlPoints = {
        QVector3D(0, 0, 0),
        QVector3D(1, 2, 0),
        QVector3D(3, 5, 0),
        QVector3D(6, 5, 0),
        QVector3D(8, 3, 0)
    };

    int degree = 3; // Кубический сплайн
    int n = controlPoints.size();
    std::vector<float> knots;

    // Установка равномерных узлов
    for (int i = 0; i < n + degree + 1; ++i) {
        knots.push_back(static_cast<float>(i));
    }

    std::vector<QVector3D> splinePoints;

    for (float u = degree; u < n; u += 0.1f) {
        splinePoints.push_back(BSplineCurve(u, controlPoints, knots, degree));
    }

    // splinePoints содержит точки В-сплайновой кривой
    return 0;
}
```

### 26.8. Заключение

В-сплайны являются мощным инструментом для создания гладких и контролируемых кривых в компьютерной графике. Их локальная управляемость и гибкость делают их идеальными для разнообразных применений, от 3D-моделирования до анимации и веб-графики.

---
