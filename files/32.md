
## 32. NURBS поверхности. Их свойства.

### 32.1. Определение

**NURBS поверхности** (Non-Uniform Rational B-Splines) — это параметрические поверхности, расширяющие возможности B-сплайнов и поверхностей Кунса за счёт введения весовых коэффициентов. Они широко используются в 3D-моделировании, CAD-системах и графическом дизайне для создания точных и гладких трёхмерных форм.

### 32.2. Свойства NURBS поверхностей

1. **Рациональные функции**:
    - Включают весовые коэффициенты для каждой контрольной точки, что позволяет точно описывать кривые и поверхности, такие как окружности и эллипсы.

2. **Неравномерные узлы**:
    - Позволяют контролировать плотность узлов, обеспечивая большую гибкость и точность в моделировании кривых и поверхностей.

3. **Локальная управляемость**:
    - Изменение одной контрольной точки или её веса влияет только на локальную часть поверхности, что упрощает редактирование.

4. **Высокая гладкость**:
    - Обеспечивают непрерывность первых и вторых производных по обоим параметрам, что создаёт плавные и гладкие поверхности.

5. **Параметрическая зависимость**:
    - Каждая точка поверхности определяется двумя параметрами, что позволяет легко интерполировать и манипулировать поверхностью.

6. **Универсальность**:
    - Подходят для создания как линейных, так и органических форм, обеспечивая точность и плавность.

### 32.3. Формула NURBS поверхности

NURBS поверхность определяется следующим образом:

\[
S(u, v) = \frac{\sum_{i=0}^{n} \sum_{j=0}^{m} N_{i,k}(u) M_{j,l}(v) w_{ij} P_{ij}}{\sum_{i=0}^{n} \sum_{j=0}^{m} N_{i,k}(u) M_{j,l}(v) w_{ij}}
\]

- \( N_{i,k}(u) \) и \( M_{j,l}(v) \) — базисные функции B-сплайнов степени \( k \) и \( l \) по параметрам \( u \) и \( v \) соответственно.
- \( w_{ij} \) — весовые коэффициенты контрольных точек.
- \( P_{ij} \) — контрольные точки.

### 32.4. Достоинства NURBS поверхностей

1. **Точность**:
    - Позволяют точно описывать сложные геометрические формы, включая окружности, эллипсы и другие кривые, которые невозможно точно представить с помощью стандартных B-сплайнов.

2. **Гибкость**:
    - Обеспечивают высокую степень контроля над формой поверхности через контрольные точки и весовые коэффициенты.

3. **Локальная управляемость**:
    - Изменение одной контрольной точки или её веса влияет только на локальную часть поверхности, упрощая редактирование.

4. **Гладкость**:
    - Обеспечивают плавные и непрерывные поверхности с высокой степенью гладкости.

5. **Универсальность**:
    - Подходят для широкого спектра приложений, от 3D-моделирования до архитектурной визуализации и промышленного дизайна.

### 32.5. Недостатки NURBS поверхностей

1. **Сложность реализации**:
    - Требуют более сложных алгоритмов для построения и обработки поверхностей по сравнению с простыми B-сплайнами и кривыми Безье.

2. **Высокие вычислительные затраты**:
    - Могут быть ресурсоёмкими, особенно при работе с большими и сложными поверхностями.

3. **Требовательность к контролю**:
    - Необходимость точной настройки контрольных точек и весовых коэффициентов для достижения желаемой формы поверхности.

4. **Трудоемкость**:
    - Требуют значительных усилий для создания и редактирования сложных форм, особенно в больших и детализированных моделях.

### 32.6. Применение NURBS поверхностей

- **CAD-системы**: Для точного проектирования технических деталей, машин и конструкций.
- **3D-моделирование и анимация**: Для создания гладких и реалистичных поверхностей объектов и персонажей.
- **Графический дизайн**: Для создания сложных и эстетически привлекательных поверхностей.
- **Архитектурная визуализация**: Для моделирования точных архитектурных форм и конструкций.

### 32.7. Пример реализации NURBS поверхности

Использование специализированных библиотек, таких как OpenNURBS или встроенные функции в 3D-приложениях, облегчает создание и управление NURBS поверхностями. Ниже приведён упрощённый пример использования библиотеки OpenNURBS.

```cpp
#include <opennurbs.h>

int main() {
    // Создание контрольных точек для NURBS поверхности (4x4 сетка)
    std::vector<std::vector<ON_4dPoint>> controlPoints = {
        {
            ON_4dPoint(0, 0, 0, 1),
            ON_4dPoint(1, 0, 2, 1),
            ON_4dPoint(2, 0, 2, 1),
            ON_4dPoint(3, 0, 0, 1)
        },
        {
            ON_4dPoint(0, 1, 2, 1),
            ON_4dPoint(1, 1, 4, 1),
            ON_4dPoint(2, 1, 4, 1),
            ON_4dPoint(3, 1, 2, 1)
        },
        {
            ON_4dPoint(0, 2, 2, 1),
            ON_4dPoint(1, 2, 4, 1),
            ON_4dPoint(2, 2, 4, 1),
            ON_4dPoint(3, 2, 2, 1)
        },
        {
            ON_4dPoint(0, 3, 0, 1),
            ON_4dPoint(1, 3, 2, 1),
            ON_4dPoint(2, 3, 2, 1),
            ON_4dPoint(3, 3, 0, 1)
        }
    };

    // Создание узловых векторов
    std::vector<double> knotsU = {0, 0, 0, 0, 1, 1, 1, 1};
    std::vector<double> knotsV = {0, 0, 0, 0, 1, 1, 1, 1};

    // Создание NURBS поверхности степени 3 по обоим параметрам
    ON_NurbsSurface surface(3, 3, 4, 4, 8, 8);

    // Установка контрольных точек
    for (int i = 0; i < 4; ++i) {
        for (int j = 0; j < 4; ++j) {
            surface.SetCV(i, j, controlPoints[i][j]);
        }
    }

    // Установка узловых векторов
    for (int i = 0; i < knotsU.size(); ++i) {
        surface.SetKnot(0, i, knotsU[i]);
    }
    for (int i = 0; i < knotsV.size(); ++i) {
        surface.SetKnot(1, i, knotsV[i]);
    }

    // Поверхность готова к использованию (отрисовке, анализу и т.д.)
    return 0;
}
```

### 32.8. Заключение

NURBS поверхности представляют собой мощный и гибкий инструмент для создания точных и гладких трёхмерных форм. Их способность точно моделировать сложные геометрические формы делает их незаменимыми в профессиональных областях компьютерной графики, CAD и дизайна.

---
