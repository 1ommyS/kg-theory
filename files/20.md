
## 20. Вычисление освещённости. Модель Гуро. Идея метода. Достоинства и недостатки.

### 20.1. Модель Гуро (Gouraud Shading)

#### Идея метода

**Модель Гуро** — это метод закраски (шейдинга) поверхностей трёхмерных объектов, который вычисляет освещённость только в вершинах полигона и интерполирует значения цветов по поверхности. Этот метод был предложен Эвином Гуро в 1971 году и стал первым широко используемым методом шейдинга в компьютерной графике.

#### Пошаговый алгоритм

1. **Вычисление нормалей**:
    - Для каждой вершины полигона вычисляется нормаль, обычно путём усреднения нормалей соседних граней.

2. **Расчёт освещённости в вершинах**:
    - Используя выбранную модель освещения (например, Ламберта), вычисляется освещённость для каждой вершины.

3. **Интерполяция цвета**:
    - Цвета вершины интерполируются по поверхности полигона, создавая плавные переходы между цветами.

4. **Закраска пикселей**:
    - Каждый пиксель внутри полигона получает цвет, основанный на интерполированном значении.

#### Достоинства модели Гуро

1. **Эффективность**:
    - Вычисляет освещённость только в вершинах, что снижает количество необходимых вычислений по сравнению с моделями, вычисляющими освещённость для каждого пикселя.

2. **Плавные переходы**:
    - Обеспечивает более плавные переходы между освещёнными и теневыми областями по сравнению с flat shading (плоским шейдингом).

3. **Подходит для реального времени**:
    - Благодаря своей эффективности метод подходит для приложений, требующих рендеринга в реальном времени, таких как игры.

#### Недостатки модели Гуро

1. **Недостаточная точность**:
    - Освещённость интерполируется только между вершинами, что может привести к неточным результатам, особенно для больших полигонов или при использовании низкого количества вершин.

2. **Проблемы с захватом отражений**:
    - Не может точно отображать зеркальные блики и высокие контрастные области освещения, что ограничивает реализм.

3. **Не поддерживает зеркальные отражения**:
    - Отсутствие расчёта отражённых лучей и других сложных эффектов освещения.

### 20.2. Применение модели Гуро

- **Игровые движки**: Используется для создания плавных и реалистичных теней и освещения поверхностей.
- **Графические приложения**: Для рендеринга трёхмерных моделей с умеренной степенью реализма.
- **Ранние 3D-игры и приложения**: Где вычислительная мощность ограничена, но требовалось улучшенное освещение по сравнению с плоским шейдингом.

### 20.3. Пример реализации модели Гуро в OpenGL

```cpp
// Вершинный шейдер (Vertex Shader)
#version 330 core
layout(location = 0) in vec3 position;
layout(location = 1) in vec3 normal;

out vec3 FragColor;

uniform vec3 lightPos;
uniform vec3 viewPos;
uniform vec3 objectColor;

void main()
{
    // Преобразование позиции
    gl_Position = projection * view * model * vec4(position, 1.0);

    // Вычисление нормали
    vec3 norm = normalize(mat3(transpose(inverse(model))) * normal);

    // Вычисление освещённости
    vec3 lightDir = normalize(lightPos - position);
    float diff = max(dot(norm, lightDir), 0.0);
    vec3 diffuse = diff * vec3(1.0); // Белый свет

    // Итоговый цвет
    FragColor = (diffuse * objectColor);
}

// Фрагментный шейдер (Fragment Shader)
#version 330 core
in vec3 FragColor;
out vec4 color;

void main()
{
    color = vec4(FragColor, 1.0);
}
```

### 20.4. Заключение

Модель Гуро предоставляет баланс между качеством освещения и вычислительной эффективностью, делая её популярным выбором для многих приложений в области компьютерной графики. Однако для достижения более высокого уровня реализма часто используются более сложные модели освещения, такие как модель Фонга или обратная трассировка лучей.

---
