
## 24. Задача интерполяции. Сплайны. Cardinal spline, его свойства.

### 24.1. Задача интерполяции

#### Определение

**Интерполяция** — это процесс нахождения функции, проходящей через заданный набор точек (узлов). В компьютерной графике интерполяция используется для создания плавных кривых и поверхностей, соединяя дискретные данные.

#### Применение

- **3D-моделирование**: Создание гладких поверхностей и контуров объектов.
- **Анимация**: Плавное движение объектов через ключевые кадры.
- **Кривые и поверхности**: Рисование и моделирование плавных линий и форм.

### 24.2. Сплайны

#### Определение

**Сплайны** — это классы кусочно-полиномиальных функций, используемых для интерполяции или аппроксимации данных. Они обеспечивают гладкость и непрерывность на стыках сегментов.

#### Типы сплайнов

1. **Линейные сплайны**:
    - Простейшие сплайны, соединяющие узлы прямыми линиями.
    - Недостаточно гладкие, так как имеют углы на стыках.

2. **Кубические сплайны**:
    - Используют кубические полиномы для каждого сегмента.
    - Обеспечивают непрерывность первых и вторых производных.

3. **Cardinal сплайны**:
    - Особый вид кубических сплайнов с параметром контроля тангенсов.

4. **B-сплайны и NURBS**:
    - Более сложные сплайны с контролем веса и гибкостью.

### 24.3. Cardinal сплайны

#### Определение

**Cardinal сплайны** — это тип кубических сплайнов, которые используют параметр **кардинальности** (обычно обозначается как \( \tau \)) для контроля напряжения и формы кривой. При \( \tau = 0 \) получается классический кубический сплайн Кнута.

#### Свойства Cardinal сплайнов

1. **Гладкость**:
    - Обеспечивают непрерывность первых и вторых производных на стыках сегментов.

2. **Контроль тангенсов**:
    - Параметр \( \tau \) позволяет регулировать напряжение кривой, делая её более гладкой или натянутой.

3. **Локальная управляемость**:
    - Изменение одного узла влияет только на соседние сегменты кривой, что облегчает её редактирование.

4. **Гибкость формы**:
    - Возможность создания разнообразных форм кривой за счёт изменения параметра \( \tau \).

#### Формула Cardinal сплайна

Каждый сегмент Cardinal сплайна между узлами \( P_i \) и \( P_{i+1} \) определяется следующей формулой:

\[
C(t) = h_1(t) P_i + h_2(t) P_{i+1} + h_3(t) T_i + h_4(t) T_{i+1}
\]

- \( t \) — параметр от 0 до 1.
- \( P_i, P_{i+1} \) — узловые точки.
- \( T_i, T_{i+1} \) — тангенсы в узловых точках, определяются как:
  \[
  T_i = \frac{1 - \tau}{2} (P_{i+1} - P_{i-1})
  \]

- \( h_1(t), h_2(t), h_3(t), h_4(t) \) — базисные функции:
  \[
  h_1(t) = 2t^3 - 3t^2 + 1
  \]
  \[
  h_2(t) = -2t^3 + 3t^2
  \]
  \[
  h_3(t) = t^3 - 2t^2 + t
  \]
  \[
  h_4(t) = t^3 - t^2
  \]

### 24.4. Достоинства Cardinal сплайнов

1. **Гибкость формы**:
    - Параметр \( \tau \) позволяет контролировать форму кривой, делая её более натянутой или сглаженной.

2. **Гладкость**:
    - Обеспечивают плавные переходы между сегментами, избегая резких углов.

3. **Локальная управляемость**:
    - Изменение одного узла влияет только на соседние сегменты, что упрощает редактирование кривой.

4. **Простота реализации**:
    - Относительно простые математические формулы для расчёта сегментов кривой.

### 24.5. Недостатки Cardinal сплайнов

1. **Ограниченная точность**:
    - Могут не точно проходить через все заданные точки, особенно при высоких значениях \( \tau \).

2. **Необходимость настройки параметра**:
    - Для достижения желаемой формы кривой требуется правильная настройка параметра \( \tau \).

3. **Необходимость дополнительных вычислений**:
    - Требуют вычисления тангенсов для каждой точки, что увеличивает сложность по сравнению с некоторыми другими сплайнами.

### 24.6. Пример использования Cardinal сплайнов

```cpp
#include <vector>
#include <QVector3D>

// Функция для вычисления Cardinal сплайна
QVector3D cardinalSpline(float t, QVector3D P0, QVector3D P1, QVector3D P2, QVector3D P3, float tau) {
    float t2 = t * t;
    float t3 = t2 * t;

    float h1 = 2*t3 - 3*t2 + 1;
    float h2 = -2*t3 + 3*t2;
    float h3 = t3 - 2*t2 + t;
    float h4 = t3 - t2;

    QVector3D T1 = (1 - tau) / 2.0f * (P2 - P0);
    QVector3D T2 = (1 - tau) / 2.0f * (P3 - P1);

    return h1 * P1 + h2 * P2 + h3 * T1 + h4 * T2;
}

int main() {
    std::vector<QVector3D> points = {
        QVector3D(0, 0, 0),
        QVector3D(1, 2, 0),
        QVector3D(3, 5, 0),
        QVector3D(6, 5, 0)
    };

    float tau = 0.5f; // Параметр кардинальности
    std::vector<QVector3D> splinePoints;

    for (size_t i = 1; i < points.size() - 2; ++i) {
        for (float t = 0.0f; t <= 1.0f; t += 0.1f) {
            splinePoints.push_back(cardinalSpline(t, points[i-1], points[i], points[i+1], points[i+2], tau));
        }
    }

    // splinePoints содержит точки кубической кривой
    return 0;
}
```

### 24.7. Заключение

Cardinal сплайны предоставляют эффективный способ создания гладких и контролируемых кривых в компьютерной графике. Их гибкость и простота реализации делают их популярными для различных приложений, однако требуют тщательной настройки параметров для достижения оптимальных результатов.

---
