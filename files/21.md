
## 21. Вычисление освещённости. Модель Фонга. Идея метода. Достоинства и недостатки.

### 21.1. Модель Фонга (Phong Shading)

#### Идея метода

**Модель Фонга** — это метод шейдинга, который обеспечивает более реалистичное освещение поверхностей по сравнению с моделью Гуро. Она вычисляет освещённость для каждого пикселя, используя нормали поверхности и направления источников света, что позволяет получать чёткие и реалистичные блики.

#### Пошаговый алгоритм

1. **Вычисление нормалей**:
    - Для каждого фрагмента (пикселя) поверхности вычисляется нормаль, обычно путём интерполяции нормалей вершин.

2. **Расчёт освещённости для каждого фрагмента**:
    - Используется комплексная модель освещения, включающая фоновое освещение, рассеянное освещение и зеркальное отражение.

3. **Комбинация компонентов освещения**:
    - Итоговый цвет фрагмента вычисляется как сумма фона, рассеянного и зеркального освещений.

#### Формула модели Фонга

\[
I = I_{ambient} \times K_a + I_{diffuse} \times K_d \times \max(0, \mathbf{N} \cdot \mathbf{L}) + I_{specular} \times K_s \times (\max(0, \mathbf{R} \cdot \mathbf{V}))^{\alpha}
\]

- **Ambient**: Фоновое освещение.
- **Diffuse**: Рассеянное освещение.
- **Specular**: Зеркальное отражение.

#### Достоинства модели Фонга

1. **Высокая реалистичность**:
    - Позволяет получать чёткие и реалистичные блики, улучшая визуальное качество.

2. **Гибкость**:
    - Поддерживает различные материалы и типы поверхностей благодаря параметрам коэффициентов отражения.

3. **Локальное освещение**:
    - Учитывает локальные источники света, что позволяет создавать сложные сцены с множеством световых источников.

#### Недостатки модели Фонга

1. **Высокие вычислительные затраты**:
    - Вычисляет освещённость для каждого пикселя, что требует больше ресурсов по сравнению с моделью Гуро.

2. **Не учитывает глобальное освещение**:
    - Не моделирует отражённый свет от других объектов сцены, ограничивая реализм в сложных сценах.

3. **Артефакты при низком разрешении нормалей**:
    - При использовании низкого количества нормалей могут возникать артефакты, такие как ступенчатость бликов.

### 21.2. Применение модели Фонга

- **3D-моделирование и анимация**: Для создания реалистичных поверхностей и материалов.
- **Игровые движки**: Для улучшения визуального качества объектов и персонажей.
- **Визуальные эффекты**: В киноиндустрии для создания реалистичных эффектов освещения.

### 21.3. Пример реализации модели Фонга в OpenGL

```cpp
// Вершинный шейдер (Vertex Shader)
#version 330 core
layout(location = 0) in vec3 position;
layout(location = 1) in vec3 normal;

out vec3 FragPos;
out vec3 Normal;

uniform mat4 model;
uniform mat4 view;
uniform mat4 projection;

void main()
{
    FragPos = vec3(model * vec4(position, 1.0));
    Normal = mat3(transpose(inverse(model))) * normal;  
    gl_Position = projection * view * vec4(FragPos, 1.0);
}

// Фрагментный шейдер (Fragment Shader)
#version 330 core
in vec3 FragPos;
in vec3 Normal;

out vec4 color;

uniform vec3 lightPos;
uniform vec3 viewPos;
uniform vec3 objectColor;
uniform vec3 lightColor;

void main()
{
    // Фоновое освещение
    float ambientStrength = 0.1;
    vec3 ambient = ambientStrength * lightColor;
    
    // Рассеянное освещение
    vec3 norm = normalize(Normal);
    vec3 lightDir = normalize(lightPos - FragPos);
    float diff = max(dot(norm, lightDir), 0.0);
    vec3 diffuse = diff * lightColor;
    
    // Зеркальное освещение
    float specularStrength = 0.5;
    vec3 viewDir = normalize(viewPos - FragPos);
    vec3 reflectDir = reflect(-lightDir, norm);
    float spec = pow(max(dot(viewDir, reflectDir), 0.0), 32);
    vec3 specular = specularStrength * spec * lightColor;  
    
    vec3 result = (ambient + diffuse + specular) * objectColor;
    color = vec4(result, 1.0);
}
```

### 21.4. Заключение

Модель Фонга обеспечивает более высокую реалистичность освещения по сравнению с моделью Гуро, добавляя зеркальные блики и улучшая визуальное качество поверхностей. Несмотря на повышенные вычислительные затраты, её эффективность делает её популярным выбором в различных областях компьютерной графики.

---
